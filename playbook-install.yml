---

# This noop is required to gather `ansible_env` facts
- hosts: all

- hosts: build
  roles:
    - common
    - elixir
    - server_build

# - hosts: database
#   roles:
#     - common
#     - postgres

# - hosts: client
#   roles:
#     - common
#     - node

- hosts: server
  environment:
    PATH: "{{ ansible_env.PATH }}:/home/{{ ansible_user }}/"
  roles:
    - common
    - server_deploy
#     # - app_server
#     # - nginx
#     # - ssl

#   # Run nginx again to ensure SSL changes are in effect
# - hosts: server
#   roles:
#     - nginx
